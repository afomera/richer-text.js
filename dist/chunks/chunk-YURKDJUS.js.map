{
  "version": 3,
  "sources": ["../../src/editor/ActiveStorageUploader.js"],
  "sourcesContent": ["import { DirectUpload } from \"@rails/activestorage\";\n\nexport class ActiveStorageUploader {\n  constructor(file, onProgress, onComplete, onFailure, onCancel) {\n    this.upload = new DirectUpload(file, this.url, this);\n\n    this.onProgress = onProgress;\n    this.onComplete = onComplete;\n    this.onFailure = onFailure;\n    this.onCancel = onCancel;\n\n    // this.upload.file.preview = URL.createObjectURL(file);\n  }\n\n  start() {\n    const promise = new Promise((resolve, reject) => {\n      this.upload.create((error, blob) => {\n        if (error) reject(error);\n        else resolve(blob);\n      });\n    });\n\n    return promise\n      .then((blob) => this.onComplete({ signedId: blob.signed_id }, this.upload))\n      .catch((error) => this.onFailure(error, this.upload));\n  }\n\n  cancel() {\n    if (this.uploadRequest) {\n      this.uploadRequest.abort();\n      this.onCancel ? this.onCancel(this.upload) : null;\n    }\n  }\n\n  directUploadWillStoreFileWithXHR(request) {\n    this.uploadRequest = request;\n    request.upload.addEventListener(\"progress\", (progress) => {\n      this.onProgress(progress, this.upload);\n    });\n  }\n\n  // TODO: Fetch this URL from the Editor Element?\n  get url() {\n    return \"/rails/active_storage/direct_uploads\";\n  }\n}\n"],
  "mappings": ";AAAA,SAAS,oBAAoB;AAEtB,IAAM,wBAAN,MAA4B;AAAA,EACjC,YAAY,MAAM,YAAY,YAAY,WAAW,UAAU;AAC7D,SAAK,SAAS,IAAI,aAAa,MAAM,KAAK,KAAK,IAAI;AAEnD,SAAK,aAAa;AAClB,SAAK,aAAa;AAClB,SAAK,YAAY;AACjB,SAAK,WAAW;AAAA,EAGlB;AAAA,EAEA,QAAQ;AACN,UAAM,UAAU,IAAI,QAAQ,CAAC,SAAS,WAAW;AAC/C,WAAK,OAAO,OAAO,CAAC,OAAO,SAAS;AAClC,YAAI;AAAO,iBAAO,KAAK;AAAA;AAClB,kBAAQ,IAAI;AAAA,MACnB,CAAC;AAAA,IACH,CAAC;AAED,WAAO,QACJ,KAAK,CAAC,SAAS,KAAK,WAAW,EAAE,UAAU,KAAK,UAAU,GAAG,KAAK,MAAM,CAAC,EACzE,MAAM,CAAC,UAAU,KAAK,UAAU,OAAO,KAAK,MAAM,CAAC;AAAA,EACxD;AAAA,EAEA,SAAS;AACP,QAAI,KAAK,eAAe;AACtB,WAAK,cAAc,MAAM;AACzB,WAAK,WAAW,KAAK,SAAS,KAAK,MAAM,IAAI;AAAA,IAC/C;AAAA,EACF;AAAA,EAEA,iCAAiC,SAAS;AACxC,SAAK,gBAAgB;AACrB,YAAQ,OAAO,iBAAiB,YAAY,CAAC,aAAa;AACxD,WAAK,WAAW,UAAU,KAAK,MAAM;AAAA,IACvC,CAAC;AAAA,EACH;AAAA;AAAA,EAGA,IAAI,MAAM;AACR,WAAO;AAAA,EACT;AACF;",
  "names": []
}
